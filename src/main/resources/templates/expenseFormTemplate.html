<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Add Expense</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/body.css}" rel="stylesheet">
    <link th:href="@{/css/button.css}" rel="stylesheet">
    <link rel="icon" type="image/x-icon" th:href="@{./favicon.ico}">
</head>
<body class="d-flex justify-content-center align-items-center">
<div class="container py-4">
    <div class="rounded card p-4 shadow-sm mx-auto" style="max-width: 500px;">
        <div class="jumbotron text-center">
            <h4 class="display-4">Add Expense</h4>
        </div>
        <form th:action="@{/my-renovations/add-expense(recordId=${recordId},jobId=${jobId})}" method="post" id="expenseForm">
            <label for="expenseCost" class="form-label">Cost</label>
            <div class="input-group mb-3">
                <span class="input-group-text">$</span>
                <input type="text" class="form-control w-35" id="expenseCost" autocomplete="off"
                       th:name="expenseCost" th:value="${expenseCost}">
                <div id="expenseCostErrorMessage" th:text="${expenseCostErrorMessage}" class="invalid-feedback"></div>
            </div>
            <div>
                <label for="description" class="form-label">Description</label>
                <textarea type="text" class="form-control" id="description" autocomplete="off"
                          th:name="description" th:value="${description}"></textarea>
                <div id="descriptionErrorMessage" th:text="${descriptionErrorMessage}" class="invalid-feedback"></div>
            </div>
            <div id="descriptionHelpBlock" class="form-text mb-3" th:text="${descLen}">
                0/512
            </div>
            <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" th:name="category">
                    <option th:value="'No Category'" selected>No Category</option>
                    <option th:value="Material">Material</option>
                    <option th:value="Labour">Labour</option>
                    <option th:value="'Fittings and Appliances'">Fittings and Appliances</option>
                    <option th:value="'Building Consent'">Building Consent</option>
                    <option th:value="Insurance">Insurance</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="expenseDate" class="form-label">Date</label>
                <input type="text" class="form-control" id="expenseDate" placeholder="DD/MM/YYYY" autocomplete="off"
                       th:name="expenseDate" th:value="${expenseDate}">
                <div id="expenseDateErrorMessage" th:text="${expenseDateErrorMessage}" class="invalid-feedback"></div>
            </div>
            <div class="mt-3">
                <button id="createExpenseBtn" type="submit" formnovalidate class="btn btn-primary w-100 mt-3">Create</button>
                <a th:href="@{/my-renovations/job-details(jobId=${jobId})}" class="btn btn-secondary w-100 mt-1">Cancel</a>
            </div>
        </form>
    </div>
</div>
<script>
    window.onload = function() {
        const inputFields = ["expenseCost", "description", "expenseDate"];
        inputFields.forEach((inputField) => {
            if (document.getElementById(inputField + "ErrorMessage").textContent !== "") {
                document.getElementById(inputField).classList.add("is-invalid");
            }
        })
        document.getElementById("description").defaultValue = `[[${description}]]`;

        const category = `[[${category}]]`;
        document.querySelectorAll("option").forEach(option => {
            option.selected = (option.value === category);
        })
    };

    document.getElementById("description").addEventListener("input", function() {
        const text = document.getElementById("description").value;
        const length = [...text].length; // Spread into an array of code points
        document.getElementById("descriptionHelpBlock").textContent = length + "/512";
    })
</script>
</body>
</html>