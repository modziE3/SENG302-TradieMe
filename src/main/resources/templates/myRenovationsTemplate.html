<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Renovations</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/styles.css}" rel="stylesheet">
    <link th:href="@{/css/body.css}" rel="stylesheet">
    <link th:href="@{/css/button.css}" rel="stylesheet">
    <link rel="icon" type="image/x-icon" th:href="@{./favicon.ico}">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="rounded container mt-3">
    <div class="d-flex flex-wrap align-items-start mb-30px">
        <div th:insert="~{fragments/breadCrumb :: bread-crumb-nav()}"></div>
        <a
           class="btn btn-primary mt-3 mb-3 ms-auto"
           style="margin-top: 0.5rem;"
           th:href="@{/my-renovations/create-renovation}">
            + Create new renovation record
        </a>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        <h4 th:if="${paginatedRenovationRecords.size() == 0}">No renovation records</h4>
        <div class="col" th:each="record : ${paginatedRenovationRecords}">
            <div class="card h-100 shadow-sm">
                <a th:href="@{/my-renovations/details(recordId=${record.getId()})}"
                     tabindex="0"
                     class="card-body d-flex justify-content-between align-items-center text-decoration-none">
                    <div class="d-block" th:text="${record.getName()}"></div>
                    <div class="d-block">
                        <button onclick="event.preventDefault()" type="button" class="btn btn-danger fs-6 h-25"
                                data-bs-toggle="modal" data-bs-target="#confirmationPrompt"
                                th:data-record-id="${record.getId()}">
                            Delete
                        </button>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div style="position: relative; left: 50%; transform: translate(-50%, 20%);" id="renovationsPagination">
      <div th:replace="~{fragments/pagination.html :: page-navigation(
        @{/my-renovations},
        ${renovationsResults},
        ${renovationsPage},
        ${lastPageRenovations},
        'renovationsPageNumber',
        'renovationsPage',
        'renovationsPageField',
        'renovationsGoButton',
        'renovationsPageFieldError')}">
      </div>
    </div>
    <!-- HTML modal code provided by Bootstrap website: https://getbootstrap.com/docs/5.3/components/modal/ -->
    <div class="modal fade" id="confirmationPrompt" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
              <div class="modal-body">
                Are you sure you want to delete this renovation record?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form th:action="@{/delete-renovation(renovationsPage=${renovationsPage})}" method="POST">
                  <input type="hidden" th:name="recordId" id="modalRecordId">
                  <button type="submit" class="btn btn-danger" data-bs-dismiss="modal">Delete</button>
                </form>
              </div>
            </div>
        </div>
    </div>
  </div>
  <!--Scripts provided by ChatGPT-->
  <script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function () {
        let confirmationPrompt = document.getElementById("confirmationPrompt");

        confirmationPrompt.addEventListener("show.bs.modal", function (event) {
            let button = event.relatedTarget;
            let recordId = button.getAttribute("data-record-id");
            document.getElementById("modalRecordId").value = recordId;
        });
      });
  </script>
</body>
</html>