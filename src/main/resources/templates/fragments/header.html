<div th:fragment="header" style="padding-bottom: 80px">
    <!--    Desktop Navbar -->
    <nav class="navbar navbar-expand-lg bg-light desktop-navbar" style="display: none; z-index: 5; width: 100%; position: fixed;">
        <div class="container" style="margin-bottom: -10px;">
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="navbar-nav">
                        <a th:href="@{/home}" class="nav-link active">
                            <img th:src="@{'/images/TradieMeLogo.png'}" class="logo-small" alt="" loading="lazy" style="border: 0px solid #c7c7c7; translate: 0 -10px" >
                        </a>
                    </li>
                    <li class="nav-item dropdown" th:if="${loggedIn == true}">
                        <a th:href="@{/my-renovations}" class="nav-link dropdown-toggle">My Renovations</a>
                        <div class="dropdown-menu" style="overflow-y: scroll; max-height: 300px">
                            <a class="dropdown-item" th:href="@{/my-renovations/create-renovation}">+ Create new renovation record</a>
                            <div class="list-group" th:each="record : ${renovationRecords}">
                                <a th:href="@{/my-renovations/details(recordId=${record.getId()})}" class="dropdown-item" th:text="${record.getName()}"></a>
                            </div>
                        </div>
                    </li>
                    <li class="navbar-nav" th:if="${loggedIn == true}">
                        <a th:href="@{'/search?searchString='}" class="nav-link">Search / Browse Renovations</a>
                    </li>
                    <li class="navbar-nav" th:if="${loggedIn == true}">
                        <a th:href="@{'/job-listings'}" class="nav-link">Available Jobs</a>
                    </li>
                    <li class="navbar-nav" th:if="${loggedIn == true}">
                        <a th:href="@{'/my-quotes'}" class="nav-link">My Quotes</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown" th:if="${loggedIn == true}">
                        <button class="nav-link dropdown-toggle" onclick="toggleProfileDropdown()" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img th:src="@{${profileImage ?: '/images/DefaultProfileImage.png'}}" class="avatar" alt="" loading="lazy" style="border: 0px solid #c7c7c7" >
                        </button>
                        <ul class="dropdown-menu " id="myProfileDropdown" aria-labelledby="navbarDropdown">
                            <li th:if="${user != null}">
                                <a class="dropdown-item" th:href="@{/profile(userId=${user.getId()})}">My Profile</a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form th:action="@{/logout}" method="post">
                                    <button type="submit" class="dropdown-item" style="color:red;text-decoration: underline;">Logout</button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mobile Navbar -->
    <nav class="navbar navbar-light bg-light mobile-navbar" style="display: none; z-index: 5; width: 100%; position: fixed;">
        <a class="navbar-brand ps-2" th:href="@{/home}">
            <img th:src="@{'/images/TradieMeLogo.png'}" class="logo-small" alt="" loading="lazy" style="border: 0px solid #c7c7c7; translate: 0 -5px" >
            TradieMe
        </a>
        <button class="navbar-toggler ms-auto" type="button" id="mobileNavbarToggler">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mobileNav">
            <ul class="navbar-nav">
                <li class="nav-item ps-3"><a th:href="@{/home}" class="nav-link">Home</a></li>
                <li class="nav-item ps-3 dropdown d-flex align-items-center" th:if="${loggedIn == true}">
                    <a th:href="@{/my-renovations}" class="nav-link">My Renovations</a>
                    <div>
                        <button class="btn dropdown-toggle" type="button" onclick="toggleDropdown()"
                                aria-expanded="false" id="dropdownMenuButton">
                            <span class="visually-hidden">Toggle Dropdown</span>
                        </button>
                        <div class="dropdown-menu position-absolute custom-dropdown" id="myRenosDropdown"
                             style="overflow-y: scroll; max-height: 300px">
                            <a class="dropdown-item" th:href="@{/my-renovations/create-renovation}">+ Create new renovation record</a>
                            <div class="list-group" th:each="record : ${renovationRecords}">
                                <a th:href="@{/my-renovations/details(recordId=${record.getId()})}" class="dropdown-item" th:text="${record.getName()}"></a>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item ps-3 dropdown d-flex align-items-center" th:if="${loggedIn == true}">
                    <a th:href="@{'/search?searchString='}" class="nav-link">Browse Renovations</a>
                </li>
                <li class="nav-item ps-3 dropdown d-flex align-items-center" th:if="${loggedIn == true}">
                    <a th:href="@{/search}" class="nav-link">Search</a>
                </li>
                <li class="nav-item ps-3 dropdown d-flex align-items-center" th:if="${loggedIn == true}">
                    <a th:href="@{/job-listings}" class="nav-link">Available Jobs</a>
                </li>
                <li class="nav-item ps-3 dropdown d-flex align-items-center" th:if="${loggedIn == true}">
                    <a th:href="@{/my-quotes}" class="nav-link">My Quotes</a>
                </li>
                <li class="nav-item ps-3 dropdown d-flex align-items-center" th:if="${loggedIn == true}">
                    <a th:href="@{/profile(userId=${user.getId()})}" class="nav-link">My Profile</a>
                </li>
                <li class="nav-item ps-3 dropdown d-flex align-items-center" th:if="${loggedIn == true}">
                    <form th:action="@{/logout}" method="post">
                        <button type="submit" class="dropdown-item" style="color:red;text-decoration: underline;">Logout</button>
                    </form>
                </li>
            </ul>
        </div>
    </nav>
    <script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script>
        window.onload = function() {
            setTimeout(function() {
                toggleNavbar();
            }, 1);

            if (document.getElementById("pageNumberErrorMessage") !== null &&
                document.getElementById("pageNumberErrorMessage").textContent !== "") {
                document.getElementById("pageNumber").classList.add("is-invalid");
            }
            if (document.getElementById("tagErrorMessage") !== null &&
                document.getElementById("tagErrorMessage").textContent !== "" &&
                document.getElementById("tagName") !== null) {
                document.getElementById("tagName").classList.add("is-invalid");
            }
        }

        window.onresize = toggleNavbar;

        function toggleNavbar() {
            let desktopNav = document.querySelector('.desktop-navbar');
            let mobileNav = document.querySelector('.mobile-navbar');
            if (window.innerWidth <= 992 || isTouchDevice()) {
                desktopNav.style.display = "none";
                mobileNav.style.display = "block";
                var navbar = document.querySelector('.navbar');
                var navbarToggler = document.querySelector('.navbar-toggler');
                var navbarRect = navbar.getBoundingClientRect();
                var rightEndPosition = navbarRect.right;
                navbarToggler.style.position = 'absolute';
                navbarToggler.style.right = '0px';
                navbarToggler.style.transform = 'translateY(-14%)';
            } else {
                desktopNav.style.display = "block";
                mobileNav.style.display = "none";
            }
        }

        function toggleDropdown() {
            var dropdown = document.getElementById("myRenosDropdown");
            if (dropdown.style.display === "block") {
                dropdown.style.display = "none";
            } else {
                dropdown.style.display = "block";
            }
        }

        function toggleProfileDropdown() {
            var dropdown = document.getElementById("myProfileDropdown");
            if (dropdown.style.display === "block") {
                dropdown.style.display = "none";
            } else {
                dropdown.style.display = "block";
            }
        }

        function isTouchDevice() {
            return (('ontouchstart' in window) ||
                (navigator.maxTouchPoints > 0) ||
                (navigator.msMaxTouchPoints > 0));
        }

        document.addEventListener("DOMContentLoaded", function () {
            const toggler = document.getElementById("mobileNavbarToggler");
            const mobileNav = document.getElementById("mobileNav");

            toggler.addEventListener("click", function () {
                mobileNav.classList.toggle("show"); // Bootstrap's "show" class controls visibility
            });
        });
    </script>
</div>
